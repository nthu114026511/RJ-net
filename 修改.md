這是我原本的想法:

$
\text{For } n=0,1,2 \dots \\
u^{n+1} = u_{NN}(\rho^n) \\
r_i^{n+1} = r_{i,NN}^n(\vec{\rho}^n, x) \\
R_i^{n+1} = R_i^n + \Delta t (r_i^n) \\
J^{n+1} = J^n + \Delta t (\nabla \cdot u) J^n - u \cdot \nabla J \\
\rho^{n+1} = \frac{\rho_0 + R^{n+1}}{J^{n+1}}
$

以下是我改變座標的想法:

Few weeks ago, we’ve tried the scheme using $\rho^{(n+1)} = \rho_0 / J^{(n+1)}$. If we write the coordinate clearly: $\rho^{(n+1)} (x(X,t), t) = \frac{\rho_0 (X)}{J^{(n+1)} (x(X,t),t)}$, it’s actually on Lagrange coordinate.
Since our work is on Euler coordinate, we need to introduce the inverse flow map $X = Y(x, t)$ and $Y(x, 0) = x$. Then implement it in our scheme, we obtain $\rho^{(n+1)} (Y(x,t), t) = \frac{\rho_0 (Y(x,t))}{J^{(n+1)} (Y(x,t),t)}$

Since $Y(x,t) = Y(\phi(X,t), t) = X$, $\dot{Y} = 0 \Rightarrow Y_t + \nabla \cdot (Y u) = Y(\nabla \cdot u)$

最後的 $\rho^{n+1} = (\rho_0 \circ Y^{n+1}) * I^{n+1}$

那麼原本的For loop應該改成怎麼樣呢?

$\text{For } n=0,1,2 ...$

$u^n(x) = u_{NN}(\rho^n(x), x), \quad \theta^n = \nabla \cdot u^n (\text{AD}),$

$r_i^n(x) = r_{i,NN}(\rho^n(x), x),$

$Y^{n+1} = Y^n - \Delta t \nabla \cdot (Y^n u^n) + \Delta t Y^n \theta^n,$

$I^{n+1} = I^n - \Delta t \nabla \cdot (I^n u^n),$

$
R_i^{n+1} = R_i^n + \Delta t (r_i^n)
$

$
\rho^{n+1} = (\rho_0 \circ Y^{n+1} + \sum_i R_i^{n+1}) I^{n+1}.
$

$\text{Loss} = \sum_{n=0}^{NT-1} [ ||\rho_t^{n+1} - \rho_{xx}^{n+1}-((\rho^{n+1})-(\rho^{n+1})^2)||^2 + \rho^{n+1}(0,t)^2 + \rho^{n+1}(1,t)^2 ]$